<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Simple Chat</title>
<style>
    body { background-color: #ccc; color: #000; font-family: monospace; }
    #chat { max-width: 500px; margin: 50px auto; }
    #messages { height: 300px; overflow-y: scroll; border: 1px solid #000; padding: 10px; background-color: #eee; }
    input { width: 80%; }
    button { width: 18%; }
</style>
</head>
<body>
<div id="chat">
    <div id="messages"></div>
    <input type="text" id="input" placeholder="Type your message...">
    <button onclick="sendMessage()">Send</button>
</div>

<script>
const messagesDiv = document.getElementById('messages');

// Fetch messages every 1 second
async function fetchMessages() {
    try {
        const res = await fetch('api/index.php');
        const messages = await res.json();
        messagesDiv.innerHTML = messages.map(m => `[${m.time}] ${m.text}`).join('<br>');
        messagesDiv.scrollTop = messagesDiv.scrollHeight;
    } catch (e) {
        console.error('Failed to fetch messages', e);
    }
}

// Send message
async function sendMessage() {
    const input = document.getElementById('input');
    const text = input.value.trim();
    if (!text) return;

    try {
        await fetch('api/index.php', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ text })
        });
        input.value = '';
        fetchMessages();
    } catch (e) {
        console.error('Failed to send message', e);
    }
}

// Start polling
setInterval(fetchMessages, 1000);
fetchMessages();
</script>
</body>
</html>
